#绪论

**数据库**是长期存储在计算机内有组织、大量、共享的数据集合。它可以供各种用户共享，具有最小冗余度和较高的数据独立性。数据库管理系统在数据库建立、运用和维护时对数据库进行统一控制，以保证数据的完整性和安全性，并在多用户同时使用数据库时进行并发控制，在发生故障后对数据库进行恢复。

## 数据模型

**数据模型：**是对现实世界数据特征的抽象，是数据库的核心和基础。

### 两类数据模型

####概念模型

按用户的观点来对数据和信息建模，主要用于数据库设计。其中一种重要的表示方法——E-R图

####逻辑模型和物理模型

**逻辑模型：**按计算机系统的观点对数据建模，主要用于数据库管理系统的实现

- 层次模型
- 网状模型
- 关系模型
- 面向对象模型
- 对象关系数据模型
- 半结构化数据模型

**物理模型：**对数据最底层的抽象，描述数据在系统内部的表示方式和存取方法，或在磁盘或磁带上的存储方式和存取方法，是面向计算机系统的。

####模式与实例

**三级模式**

**模式**：也称逻辑模式，是数据库中全体数据的逻辑结构和特征的描述，它仅仅涉及型的描述，而不涉及具体的值。模式的一个具体值称为模式的一个**实例**。(可以理解为模式为表的结构，实例为表中的值)

**内模式：**是数据物理结构和存储方式的描述

**外模式：**是数据库用户的数据视图，是模式的子集，一个数据库可以有多个

**二级映像**

**外模式/模式映像：**一个模式可以有多个外模式。当（逻辑）模式改变时，由DBA对该映像做相应改变，而无需改变外模式。应用程序是根据外模式写的，因此也不用变，这称为**数据的逻辑独立性**。

**模式/内模式映像：**一个数据库只有一个内模式。当数据库的存储结构改变时，由DBA对该映像做相应改变，而无需改变模式，进而也无需改变应用程序，这称为**数据与程序的物理独立性**。

# 关系数据库

## 概念

**1. 域**

**域**是一组具有相同数据类型的值的集合。

一个域允许的不同取值的个数称为这个域的**基数**。

**2. 笛卡尔积**

**笛卡尔积**是**域**上的一种集合运算。

笛卡尔积可表示为一张二维表。表中的`每行对应一个元组，每一列的值来自一个域`。

**3. 关系**
$$
R（D_1,D_2,...,D_n）,R是关系的名字，n是关系的目或度
$$
**4. 关系模式**

关系的描述称为**关系模式**，可表示为 ``R(U,D,DOM,F) `` R为关系的名字，U为属性名集合，D为U中属性所来自的域，DOM为属性向域的映像集合，F为属性间数据的依赖关系集合。

**5. 区分关系和关系模式**

关系是关系模式在某一时刻的状态或内容。

关系模式是静态的，稳定的，而关系是动态的、随时间不断变化的，因为关系操作在不断地更新着数据库中的数据。

**4. 码**

**候选码：**若关系中的某一属性组的值能唯一的标识一个元组，而其子集不能，则称该属性组为候选码。

**主码：**若一个关系有多个候选码，则选择其中一个作为主码。

**5. 基本关系操作集合**

选择

投影

并

差

笛卡尔积

**6. 关系完整性约束**

- **实体完整性：**若属性(一个或一组属性)A是基本关系R的主属性，则A 不能取空值。

- **参照完整性：**

- 设F是基本关系R的一个或一组属性，但不是关系R的主码，K是基本关系S的主码。若F与K相对应，则称F为R的**外码**，并称基本关系R为**参照关系**，基本关系S为**被参照关系**。

- 若属性(或属性组)F是基本关系R的外码，它与关系S的主码K相对应(基本关系R与S不一定是不同的关系)，则对于R中的每个元组在F上的值必须满足：

- - 或者取空值(F的每个属性均为空值)
  - 或者等于S中某个元组的主码值

- **用户自定义完整性：**针对某一具体关系数据库的约束条件

## 关系代数



# SQL

**SQL的特点**

- 综合统一
- 高度非过程化，只要提出做什么，无须指明怎么做
- 面向集合的参照方式
- 以同一种语法结构提供多种使用方式
- 语言简洁，易学易用

## 数据定义

| 操作对象 | 创建          | 删除        | 修改        |
| -------- | ------------- | ----------- | ----------- |
| 模式     | CREATE SCHEMA | DROP SCHEMA |             |
| 表       | CREATE TABLE  | DROP TABLE  | ALTER TABLE |
| 视图     | CREATE VIEW   | DROP VIEW   |             |
| 索引     | CREATE INDEX  | DROP INDEX  | ALTER INDEX |

### 模式的定义与删除

``CREATE SCHEMA<模式名> AUTHORIZATION <用户名> [<表定义子句>|<视图定义子句>|<授权定义子句>]``(如果没有指定<模式名>，那么<模式名>隐含为<用户名>)

``DROP SCHEMA <模式名><CASCADE|RESTRICT>``

- CASCADE 级联：删除模式时同时把该模式中所有的数据库对象全部删除
- RESTRICT 限制：如果该模式下已经定义了下属的数据库对象，则拒绝该删除语句的执行

###基本表的定义、删除与修改

```sql
#创建基本表
CREATE TABLE <表名> (<列名><数据类型>[列级完整性约束条件],
                    ...,
                   [<表级完整性约束条件>]);
                   
#修改基本表             
ALTER TABLE <表名> 
[ADD [COLUMN] <新列名><数据类型>[完整性约束]]
[ADD <表级完整性约束>]
[DROP [COLUMN] <列名> [CASCADE|RESTRICT]]
[DROP CONSTRAINT <完整性约束名> [CASCADE|RESTRICT]
[ALTER COLUMN <列名> <数据类型>];
 
#删除基本表
DROP TABLE <表名>[CASCADE|RESTRICT]
```

### 索引的建立与删除

常见索引包括：顺序文件上的索引、B+树索引、散列索引、位图索引等。关系数据库管理系统在执行查询时会自动选择合适的索引作为存取路径，**用户不必也不能显示地选择索引**。

索引会占用存储空间，基本表更新时，索引也要进行对应的维护，会加重数据库的负担，要有选择地创建索引。

**建立索引**

```sql
CREATE [UNIQUE] [CLUSTER] INDEX <索引名> 
ON <表名>(<列名>[次序][,<列名>[次序]] ... );
```

索引可以建立在该表的一列或多列上，次序可选ASC(默认升序)或DESC(降序)；UNIQUE表明此索引的每一个索引值只对应唯一的数据记录，CLUSTER表明要建立的是聚簇索引

**修改索引**

```sql 
ALTER INDEX <旧索引名> RENAME TO <新索引名>
```

**删除索引**

```sql 
DROP INDEX <索引名>
```

##数据查询

```
SELECT [ALL|DISTINCT] <目标列表达式> [,<目标列表达式> ...]
FROM <表名或视图名> [,<表名或视图名> ...]|(<SELECT语句>)[AS]<别名>
[WHERE <条件表达式>]
[GROUP BY <列名1> [HAVING <条件表达式>]]
[ORDER BY <列名2> [ASC|DESC]];
```

SQL语句解析顺序

> `from..` `on..` `join..` `where..` `group by..` `having..` `select distinct..` `order by..` `limit..`

###常用查询条件

| 查询条件 | 谓词                                        |
| -------- | ------------------------------------------- |
| 比较     | =,>,<.<=,>=,!=,<>,!<,!>;NOT +上述比较运算符 |
| 确定范围 | BETWEEN AND, NOT BETWEEN AND                |
| 确定集合 | IN, NOT IN                                  |
| 字符匹配 | LIKE, NOT LIKE                              |
| 空值     | IS NULL, IS NOT NULL                        |
| 逻辑运算 | AND, OR, NOT                                |

**字符匹配**一般语法如下，查找指定的属性列值与<匹配串>相匹配的元组

`[NOT] LIKE '<匹配串>' [ESCAPE '<换码字符>']`

<匹配串>可以含有通配符`%`和`_` ，不含通配符可以使用=而不用LIKE

- `%` 表示任意长度的字符串
- `_`表示任意单个字符

ESCAPE字符转义`WHERE Cname LIKE 'DB\_' ESCAPE '\'`，\后的一个字符不再是通配符的意思

###数据查询中关键字的使用

**ALL|DISTINCT**

指定DISTINCT：去掉重复的行；	（默认）指定ALL：保留重复的行

**ORDER BY**

对查询结果按照一个或多个属性的升序（默认ASC）或降序（DESC）排列

####聚集函数

| 聚集函数                       | 含义                                   |
| ------------------------------ | -------------------------------------- |
| COUNT(*)                       | 统计元组的个数                         |
| COUNT( [DISTINCT\|ALL] <列名>) | 统计一列中值的个数                     |
| SUM( [DISTINCT\|ALL] <列名>)   | 计算一列值的总和（此列必须是数值型）   |
| AVG( [DISTINCT\|ALL] <列名>)   | 计算一列值的平均数（此列必须是数值型） |
| MAX( [DISTINCT\|ALL] <列名>)   | 求一列值中的最大值                     |
| MIN( [DISTINCT\|ALL] <列名>)   | 求一列值中的最小值                     |

**GROUP BY**

GROUP BY子句将查询结果按某一列或多列的值分组，值相等的为一组。

**HAVING和WHERE的区别**

WHERE子句和HAVING短语的区别在于作用对象的不同。WHERE子句作用于基本表或视图，从中选出满足条件的视图。HAVING短语作用于组，从中选择满足条件的组。

WHERE子句中不能用聚集函数作为条件表达式。

### 连接查询

查询同时涉及两个及以上的表，成为连接查询

**等值查询与非等值查询**

连接查询的WHERE子句中用来连接两个表的条件称为连接条件或连接谓词，子句格式如下：

`[<表名1>.]<列名1><比较运算符>[<表名2>.]<列名2>`

**自身连接**

连接操作也可以是一个表与自己进行连接，称为表的自身连接。

需要给自身再起一个别名

**外连接**













